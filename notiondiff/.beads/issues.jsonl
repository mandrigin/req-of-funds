{"id":"no-2q0","title":"Ingestion worker: recursive block fetching","description":"dispatched_by: mayor\n\nBuild the ingestion worker that captures page snapshots.\n\n**Architecture (per spec section 3):**\n- Debounced queue (5-min window to batch rapid edits)\n- Recursive block traversal (DFS)\n- Rate limiting (token bucket, 3 req/sec per Notion limits)\n- Pagination handling (100 blocks/request limit)\n\n**Logic:**\n1. Receive page_id trigger (webhook or manual)\n2. Fetch Page object (title, cover, icon)\n3. Fetch block children recursively\n4. For each block with has_children=true, queue child fetch\n5. Assemble full content_tree\n6. Compute block_map (ID → {hash, parent, type})\n7. Calculate content_hash (SHA-256)\n8. Check for duplicate (skip if hash matches latest)\n9. Save snapshot to database\n\n**Edge cases:**\n- Handle 429 rate limit responses (backoff + retry)\n- Handle 403/404 (mark page DISCONNECTED)\n- Flag 'dirty' snapshots if timestamps diverge during fetch\n\n**Acceptance:**\n- Can fetch and store a complete page snapshot\n- Handles nested blocks (toggles, columns, etc.)\n- Respects rate limits","status":"hooked","priority":2,"issue_type":"task","assignee":"notiondiff/polecats/slit","created_at":"2026-01-14T13:05:49.041767+01:00","created_by":"mayor","updated_at":"2026-01-14T13:49:43.953111+01:00","dependencies":[{"issue_id":"no-2q0","depends_on_id":"no-cfz","type":"blocks","created_at":"2026-01-14T13:06:08.125804+01:00","created_by":"mayor"},{"issue_id":"no-2q0","depends_on_id":"no-qi7","type":"blocks","created_at":"2026-01-14T13:06:08.195202+01:00","created_by":"mayor"}]}
{"id":"no-3b7","title":"Refinery Patrol","description":"Merge queue processor patrol loop with verification gates.","status":"open","priority":2,"issue_type":"molecule","created_at":"2026-01-14T13:01:08.486255+01:00","created_by":"mandrigin","updated_at":"2026-01-14T13:01:08.486255+01:00"}
{"id":"no-6z9","title":"Deacon Patrol","description":"Mayor's daemon patrol loop for handling callbacks, health checks, and cleanup.","status":"open","priority":2,"issue_type":"molecule","created_at":"2026-01-14T13:01:08.154454+01:00","created_by":"mandrigin","updated_at":"2026-01-14T13:01:08.154454+01:00"}
{"id":"no-cfz","title":"Database schema: PostgreSQL with Prisma","description":"dispatched_by: mayor\n\nSet up PostgreSQL database with Prisma ORM.\n\n**Tables (per spec section 4.1):**\n\n1. `monitored_pages`:\n   - id (UUID, PK)\n   - notion_page_id (VARCHAR 64, indexed)\n   - workspace_id (UUID, FK)\n   - status (ENUM: ACTIVE, PAUSED, DISCONNECTED, ARCHIVED)\n   - last_synced_at (TIMESTAMPTZ)\n   - title_cache (TEXT)\n\n2. `snapshots`:\n   - id (UUID, PK)\n   - page_id (UUID, FK to monitored_pages)\n   - version (INTEGER, sequential)\n   - content_tree (JSONB - full page hierarchy)\n   - block_map (JSONB - flattened ID→hash map for O(1) lookup)\n   - created_at (TIMESTAMPTZ)\n   - notion_edited_at (TIMESTAMPTZ)\n   - author_id (VARCHAR 64)\n   - content_hash (CHAR 64 - SHA-256 for dedup)\n\n3. `workspaces`:\n   - id (UUID, PK)\n   - notion_workspace_id (VARCHAR 64)\n   - access_token (encrypted)\n   - refresh_token (encrypted)\n   - created_at (TIMESTAMPTZ)\n\n**Acceptance:**\n- `pnpm prisma migrate dev` runs without errors\n- `pnpm prisma generate` creates typed client\n- Can create/read records in dev database","status":"closed","priority":1,"issue_type":"task","assignee":"notiondiff/polecats/nux","created_at":"2026-01-14T13:05:48.631099+01:00","created_by":"mayor","updated_at":"2026-01-14T13:42:45.311336+01:00","closed_at":"2026-01-14T13:42:45.311336+01:00","close_reason":"completed","dependencies":[{"issue_id":"no-cfz","depends_on_id":"no-wlt","type":"blocks","created_at":"2026-01-14T13:06:07.916254+01:00","created_by":"mayor"}]}
{"id":"no-d2y","title":"History timeline UI","description":"dispatched_by: mayor\n\nBuild the version history timeline component.\n\n**Design (per spec section 6.2):**\n- Vertical timeline rail showing snapshots\n- Grouping by day/session\n- Each node shows: timestamp, author avatar, change summary (+X/-Y blocks)\n- Click to select 'Current' version (right)\n- Shift+Click for 'Comparison' version (left)\n- Default: compare against previous version\n\n**Components:**\n- `\u003cTimeline /\u003e` - Container with scroll\n- `\u003cSnapshotNode /\u003e` - Individual version entry\n- `\u003cChangeSummary /\u003e` - Block count badges\n\n**Data:**\n- Fetch snapshots for page (paginated)\n- Include author info (from Notion User object if available)\n\n**Acceptance:**\n- Timeline displays snapshot history\n- Can select two versions to compare\n- Shows change counts per version","status":"closed","priority":2,"issue_type":"task","assignee":"notiondiff/polecats/furiosa","created_at":"2026-01-14T13:05:49.467807+01:00","created_by":"mayor","updated_at":"2026-01-14T13:43:09.091876+01:00","closed_at":"2026-01-14T13:43:09.091876+01:00","close_reason":"completed","dependencies":[{"issue_id":"no-d2y","depends_on_id":"no-wlt","type":"blocks","created_at":"2026-01-14T13:06:08.332015+01:00","created_by":"mayor"}]}
{"id":"no-h7a","title":"Basic diff engine: Add/Remove/Modify detection","description":"dispatched_by: mayor\n\nImplement the core diffing algorithm for comparing snapshots.\n\n**Algorithm (per spec section 5.2):**\n\nPhase 1 - Map Flattener:\n- Retrieve block_map for Snapshot A (old) and B (new)\n\nPhase 2 - Set Operations (Add/Remove):\n- Keys in A but not B → REMOVED\n- Keys in B but not A → ADDED\n\nPhase 3 - Content Check (Modify):\n- Keys in both: compare hashes\n- Different hash → MODIFIED\n\nPhase 4 - Structure Check (Move):\n- Same key, different parent → MOVED\n- (Advanced: LCS for sibling reordering - can defer)\n\n**Output format:**\n```typescript\ninterface DiffResult {\n  added: BlockDiff[];\n  removed: BlockDiff[];\n  modified: BlockDiff[];\n  moved: BlockDiff[];\n  unchanged: string[]; // block IDs\n}\n\ninterface BlockDiff {\n  id: string;\n  type: string;\n  path: string[]; // parent chain\n  oldContent?: Block;\n  newContent?: Block;\n}\n```\n\n**Acceptance:**\n- Can compare two snapshots\n- Correctly identifies added/removed/modified blocks\n- Returns structured diff result","status":"closed","priority":2,"issue_type":"task","assignee":"notiondiff/polecats/slit","created_at":"2026-01-14T13:05:49.251214+01:00","created_by":"mayor","updated_at":"2026-01-14T13:48:54.156459+01:00","closed_at":"2026-01-14T13:48:54.156459+01:00","close_reason":"completed","dependencies":[{"issue_id":"no-h7a","depends_on_id":"no-cfz","type":"blocks","created_at":"2026-01-14T13:06:08.264997+01:00","created_by":"mayor"}]}
{"id":"no-notiondiff-crew-differz","title":"Crew worker differz in notiondiff - human-managed persistent workspace.","description":"Crew worker differz in notiondiff - human-managed persistent workspace.\n\nrole_type: crew\nrig: notiondiff\nagent_state: idle\nhook_bead: null\nrole_bead: hq-crew-role\ncleanup_status: null\nactive_mr: null\nnotification_level: null","status":"open","priority":2,"issue_type":"agent","created_at":"2026-01-14T13:01:27.527357+01:00","created_by":"mandrigin","updated_at":"2026-01-14T13:01:27.637102+01:00","labels":["gt:agent"]}
{"id":"no-notiondiff-polecat-dementus","title":"no-notiondiff-polecat-dementus","description":"no-notiondiff-polecat-dementus\n\nrole_type: polecat\nrig: notiondiff\nagent_state: spawning\nhook_bead: no-rt2\nrole_bead: hq-polecat-role\ncleanup_status: null\nactive_mr: null\nnotification_level: null","status":"open","priority":2,"issue_type":"agent","created_at":"2026-01-14T13:50:08.47605+01:00","created_by":"mayor","updated_at":"2026-01-14T13:50:08.737728+01:00","labels":["gt:agent"]}
{"id":"no-notiondiff-polecat-furiosa","title":"no-notiondiff-polecat-furiosa","description":"no-notiondiff-polecat-furiosa\n\nrole_type: polecat\nrig: notiondiff\nagent_state: spawning\nhook_bead: no-wlt\nrole_bead: hq-polecat-role\ncleanup_status: has_uncommitted\nactive_mr: no-822\nnotification_level: null","status":"tombstone","priority":2,"issue_type":"agent","created_at":"2026-01-14T13:28:36.248625+01:00","created_by":"mayor","updated_at":"2026-01-14T13:45:10.985131+01:00","labels":["gt:agent"],"deleted_at":"2026-01-14T13:45:10.985131+01:00","deleted_by":"mayor","delete_reason":"delete","original_type":"agent"}
{"id":"no-notiondiff-polecat-nux","title":"no-notiondiff-polecat-nux","description":"no-notiondiff-polecat-nux\n\nrole_type: polecat\nrig: notiondiff\nagent_state: spawning\nhook_bead: no-cfz\nrole_bead: hq-polecat-role\ncleanup_status: clean\nactive_mr: no-knp\nnotification_level: null","status":"tombstone","priority":2,"issue_type":"agent","created_at":"2026-01-14T13:35:42.033153+01:00","created_by":"mayor","updated_at":"2026-01-14T13:44:42.947619+01:00","labels":["gt:agent"],"deleted_at":"2026-01-14T13:41:31.769452+01:00","deleted_by":"notiondiff/polecats/nux","delete_reason":"delete","original_type":"agent"}
{"id":"no-notiondiff-polecat-rictus","title":"no-notiondiff-polecat-rictus","description":"no-notiondiff-polecat-rictus\n\nrole_type: polecat\nrig: notiondiff\nagent_state: spawning\nhook_bead: no-ptv\nrole_bead: hq-polecat-role\ncleanup_status: null\nactive_mr: null\nnotification_level: null","status":"open","priority":2,"issue_type":"agent","created_at":"2026-01-14T13:49:47.230261+01:00","created_by":"mayor","updated_at":"2026-01-14T13:50:04.693926+01:00","labels":["gt:agent"]}
{"id":"no-notiondiff-polecat-slit","title":"no-notiondiff-polecat-slit","description":"no-notiondiff-polecat-slit\n\nrole_type: polecat\nrig: notiondiff\nagent_state: spawning\nhook_bead: no-h7a\nrole_bead: hq-polecat-role\ncleanup_status: clean\nactive_mr: no-ay9\nnotification_level: null","status":"tombstone","priority":2,"issue_type":"agent","created_at":"2026-01-14T13:44:46.209552+01:00","created_by":"mayor","updated_at":"2026-01-14T13:49:43.739238+01:00","labels":["gt:agent"],"deleted_at":"2026-01-14T13:49:30.479019+01:00","deleted_by":"notiondiff/polecats/slit","delete_reason":"delete","original_type":"agent"}
{"id":"no-notiondiff-refinery","title":"Refinery for notiondiff - processes merge queue.","description":"Refinery for notiondiff - processes merge queue.\n\nrole_type: refinery\nrig: notiondiff\nagent_state: idle\nhook_bead: null\nrole_bead: hq-refinery-role\ncleanup_status: null\nactive_mr: null\nnotification_level: null","status":"open","priority":2,"issue_type":"agent","created_at":"2026-01-14T13:01:07.862485+01:00","created_by":"mandrigin","updated_at":"2026-01-14T13:01:07.97439+01:00","labels":["gt:agent"]}
{"id":"no-notiondiff-witness","title":"Witness for notiondiff - monitors polecat health and progress.","description":"Witness for notiondiff - monitors polecat health and progress.\n\nrole_type: witness\nrig: notiondiff\nagent_state: idle\nhook_bead: null\nrole_bead: hq-witness-role\ncleanup_status: null\nactive_mr: null\nnotification_level: null","status":"open","priority":2,"issue_type":"agent","created_at":"2026-01-14T13:01:07.505682+01:00","created_by":"mandrigin","updated_at":"2026-01-14T13:01:07.620946+01:00","labels":["gt:agent"]}
{"id":"no-ptv","title":"Unified diff viewer with react-notion-x","description":"dispatched_by: mayor\n\nBuild the unified diff view using react-notion-x renderer.\n\n**Design (per spec section 6.3 Mode A):**\n- Renders like a Notion page but annotated with changes\n- Uses react-notion-x as base renderer\n- Wrap block components with \u003cDiffWrapper\u003e HOC\n\n**Styling:**\n- Added blocks: green background (bg-green-50), green left border\n- Removed blocks: red background (bg-red-50), strikethrough\n- Modified blocks: yellow highlight\n\n**Implementation:**\n- Install react-notion-x\n- Create NotionRenderer wrapper component\n- Build DiffWrapper HOC that receives diffStatus\n- Inject removed blocks from old version at original positions\n- Handle intra-block text diffs (spans with diff-add/diff-rem classes)\n\n**Acceptance:**\n- Can render a page with diff annotations\n- Added/removed/modified blocks visually distinct\n- Text changes highlighted inline","status":"hooked","priority":2,"issue_type":"task","assignee":"notiondiff/polecats/rictus","created_at":"2026-01-14T13:05:49.676726+01:00","created_by":"mayor","updated_at":"2026-01-14T13:50:04.909648+01:00","dependencies":[{"issue_id":"no-ptv","depends_on_id":"no-h7a","type":"blocks","created_at":"2026-01-14T13:06:08.408916+01:00","created_by":"mayor"},{"issue_id":"no-ptv","depends_on_id":"no-d2y","type":"blocks","created_at":"2026-01-14T13:06:08.481832+01:00","created_by":"mayor"}]}
{"id":"no-qi7","title":"Notion OAuth integration","description":"dispatched_by: mayor\n\nImplement Notion OAuth 2.0 flow for workspace authorization.\n\n**Flow (per spec section 6.1):**\n1. User clicks 'Connect Notion'\n2. Redirect to Notion authorization page\n3. User selects pages to share\n4. Callback receives auth code\n5. Exchange code for access token\n6. Store encrypted tokens in database\n7. Redirect to dashboard\n\n**Implementation:**\n- `/api/auth/notion/route.ts` - Initiate OAuth\n- `/api/auth/callback/route.ts` - Handle callback\n- Use NextAuth.js or custom implementation\n- Encrypt tokens before storage (AES-256)\n\n**Notion API:**\n- Client ID/Secret from environment\n- Scopes: read pages, read blocks, read users\n\n**Acceptance:**\n- Can complete OAuth flow\n- Access token stored securely\n- Can make authenticated API calls to Notion","status":"closed","priority":1,"issue_type":"task","assignee":"notiondiff/polecats/nux","created_at":"2026-01-14T13:05:48.831393+01:00","created_by":"mayor","updated_at":"2026-01-14T13:50:12.989583+01:00","closed_at":"2026-01-14T13:50:12.989583+01:00","close_reason":"completed","dependencies":[{"issue_id":"no-qi7","depends_on_id":"no-wlt","type":"blocks","created_at":"2026-01-14T13:06:07.986934+01:00","created_by":"mayor"},{"issue_id":"no-qi7","depends_on_id":"no-cfz","type":"blocks","created_at":"2026-01-14T13:06:08.057695+01:00","created_by":"mayor"}]}
{"id":"no-rig-notiondiff","title":"notiondiff","description":"Rig identity bead for notiondiff.\n\nrepo: git@github.com:mandrigin/notion-diff.git\nprefix: no\nstate: active","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-14T13:01:08.62631+01:00","created_by":"mandrigin","updated_at":"2026-01-14T13:01:08.62631+01:00","labels":["gt:rig"]}
{"id":"no-rt2","title":"Dashboard and page monitoring UI","description":"Build the main dashboard for managing monitored pages.\n\n**Features (per spec section 6.1):**\n- List of monitored pages with:\n  - Page title\n  - Last sync time\n  - Version count\n  - Status (Active/Paused/Disconnected/Error)\n- 'Sync Now' button for manual refresh\n- 'Add Page' flow (select from authorized pages)\n- Status indicators and error states\n\n**Components:**\n- `\u003cDashboard /\u003e` - Main container\n- `\u003cPageList /\u003e` - Table of monitored pages\n- `\u003cPageRow /\u003e` - Individual page with actions\n- `\u003cAddPageModal /\u003e` - Select pages to monitor\n\n**Acceptance:**\n- Shows list of monitored pages\n- Can add new pages to monitoring\n- Can trigger manual sync\n- Status accurately reflects page state","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-14T13:05:49.893195+01:00","created_by":"mayor","updated_at":"2026-01-14T13:05:49.893195+01:00","dependencies":[{"issue_id":"no-rt2","depends_on_id":"no-wlt","type":"blocks","created_at":"2026-01-14T13:06:08.551285+01:00","created_by":"mayor"},{"issue_id":"no-rt2","depends_on_id":"no-qi7","type":"blocks","created_at":"2026-01-14T13:06:08.622076+01:00","created_by":"mayor"}]}
{"id":"no-sde","title":"Witness Patrol","description":"Per-rig worker monitor patrol loop with progressive nudging.","status":"open","priority":2,"issue_type":"molecule","created_at":"2026-01-14T13:01:08.316995+01:00","created_by":"mandrigin","updated_at":"2026-01-14T13:01:08.316995+01:00"}
{"id":"no-wlt","title":"Project scaffolding: Next.js 14+ with TypeScript","description":"dispatched_by: mayor\n\nInitialize the Next.js project with best practices for local TS development:\n\n**Stack:**\n- Next.js 14+ with App Router\n- TypeScript (strict mode)\n- Tailwind CSS\n- ESLint + Prettier\n- pnpm as package manager\n\n**Directory structure:**\n```\nsrc/\n  app/           # Next.js App Router pages\n  components/    # React components\n  lib/           # Utility functions, API clients\n  db/            # Database schema, queries\n  types/         # TypeScript type definitions\n```\n\n**Config files:**\n- tsconfig.json with strict settings\n- tailwind.config.ts\n- .eslintrc.json\n- .prettierrc\n- .env.example\n\n**Acceptance:**\n- `pnpm dev` starts dev server\n- `pnpm build` compiles without errors\n- `pnpm lint` passes","status":"closed","priority":1,"issue_type":"task","assignee":"notiondiff/polecats/furiosa","created_at":"2026-01-14T13:05:48.408128+01:00","created_by":"mayor","updated_at":"2026-01-14T13:34:44.037659+01:00","closed_at":"2026-01-14T13:34:44.037659+01:00","close_reason":"completed"}
{"id":"no-z0x","title":"Phase 1: Core Foundation","description":"Build the foundational version of Notion Diff per spec. Includes project setup, database, OAuth, ingestion, diffing, and unified diff UI.\n\nReference: /Users/mandrigin/Desktop/notiondiff-spec.md","status":"open","priority":1,"issue_type":"epic","created_at":"2026-01-14T13:04:48.709614+01:00","created_by":"mayor","updated_at":"2026-01-14T13:04:48.709614+01:00","dependencies":[{"issue_id":"no-z0x","depends_on_id":"no-wlt","type":"blocks","created_at":"2026-01-14T13:06:08.793743+01:00","created_by":"mayor"},{"issue_id":"no-z0x","depends_on_id":"no-cfz","type":"blocks","created_at":"2026-01-14T13:06:08.866428+01:00","created_by":"mayor"},{"issue_id":"no-z0x","depends_on_id":"no-qi7","type":"blocks","created_at":"2026-01-14T13:06:08.93504+01:00","created_by":"mayor"},{"issue_id":"no-z0x","depends_on_id":"no-2q0","type":"blocks","created_at":"2026-01-14T13:06:09.006052+01:00","created_by":"mayor"},{"issue_id":"no-z0x","depends_on_id":"no-h7a","type":"blocks","created_at":"2026-01-14T13:06:09.075851+01:00","created_by":"mayor"},{"issue_id":"no-z0x","depends_on_id":"no-d2y","type":"blocks","created_at":"2026-01-14T13:06:09.151448+01:00","created_by":"mayor"},{"issue_id":"no-z0x","depends_on_id":"no-ptv","type":"blocks","created_at":"2026-01-14T13:06:09.225117+01:00","created_by":"mayor"},{"issue_id":"no-z0x","depends_on_id":"no-rt2","type":"blocks","created_at":"2026-01-14T13:06:09.296615+01:00","created_by":"mayor"}]}
